{"id":"docx_redline-03e","title":"Implement TrackedXMLGenerator for insertions","description":"Create tracked_xml.py with TrackedXMLGenerator class. Generate \u003cw:ins\u003e XML with auto-incrementing IDs, timestamps, RSID, author. Handle xml:space='preserve'. See docs/IMPLEMENTATION_NOTES.md lines 280-317.","status":"closed","priority":0,"issue_type":"task","assignee":"Claude","created_at":"2025-12-06T08:39:51.907603-06:00","updated_at":"2025-12-06T11:01:12.647583-06:00","closed_at":"2025-12-06T11:01:12.647583-06:00","close_reason":"Closed","labels":["core"]}
{"id":"docx_redline-0i0","title":"Epic 1: MVP - Core Text Operations","description":"Implement core functionality to enable surgical edits without writing XML. Goal: Complete all 11 surgical edits from examples/surgical_edits.yaml using high-level API.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-06T08:39:30.392408-06:00","updated_at":"2025-12-08T08:02:04.809065-06:00","closed_at":"2025-12-08T08:02:04.809065-06:00","close_reason":"Closed","labels":["epic"]}
{"id":"docx_redline-186","title":"Implement proper resource cleanup for temp directories","description":"Temporary directories created during document processing may not be cleaned up if save() isn't called or exceptions occur.","design":"## Problem\nDocument._extract_docx() creates temp dirs but cleanup isn't guaranteed in all paths.\n\n## Implementation\n1. Add __del__ method to Document class:\n   ```python\n   def __del__(self):\n       self.close()\n   ```\n2. Add close() method:\n   ```python\n   def close(self):\n       if self._temp_dir and self._temp_dir.exists():\n           shutil.rmtree(self._temp_dir)\n           self._temp_dir = None\n   ```\n3. Update __exit__ to call close()\n4. Make close() idempotent (safe to call multiple times)\n\n## Key Files\n- src/docx_redline/document.py - Add __del__, close(), update __exit__\n- tests/test_document.py - Add cleanup verification tests\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] close() method added and idempotent\n- [ ] __del__ calls close()\n- [ ] __exit__ calls close()\n- [ ] Test verifies temp dir removed after context manager exit\n- [ ] Test verifies temp dir removed after explicit close()\n- [ ] Test verifies temp dir removed after exception\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-09T11:06:52.924623-06:00","updated_at":"2025-12-09T11:06:52.924623-06:00","dependencies":[{"issue_id":"docx_redline-186","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:06:52.92586-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-1g2","title":"Create Section wrapper class","description":"Create a Section class to represent document sections (heading + paragraphs until next heading).\n\nRequirements:\n- Property: heading (the Paragraph that starts the section)\n- Property: paragraphs (all paragraphs in this section, including heading)\n- Property: heading_text (convenience property)\n- Property: heading_level (1-9)\n- Method: contains(text) - check if any paragraph in section contains text\n- Method: find_paragraph(text) - find first paragraph containing text\n- Class method: from_document(doc) -\u003e list[Section] - parse all sections\n\nImplementation notes:\n- A section is defined as: heading paragraph + all following paragraphs until the next heading\n- Paragraphs before the first heading belong to an implicit intro section\n- Should work with existing scope system (scope='section:Name')\n- Build on top of Paragraph class\n\nFiles to create:\n- src/docx_redline/models/section.py\n- tests/test_section.py\n\nDependencies:\n- Requires Paragraph class (docx_redline-yik)\n\nSuccess criteria:\n- Can parse document into sections\n- Can access section heading and paragraphs\n- Section detection matches existing scope system behavior\n- 10+ tests covering all methods","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-08T08:18:40.367621-06:00","updated_at":"2025-12-08T08:32:20.698819-06:00","closed_at":"2025-12-08T08:32:20.698819-06:00","close_reason":"Closed","labels":["core"]}
{"id":"docx_redline-1nx","title":"Add comment resolve/unresolve API","description":"Implement comment resolution status management.\n\n**What**: Add ability to mark comments as resolved/unresolved\n**Why**: Enable tracking of addressed vs pending comments during review\n**Where**: src/docx_redline/document.py, src/docx_redline/models/comment.py, word/commentsExtended.xml\n\n## Implementation Approach\nResolution status is stored in commentsExtended.xml via w15:commentEx with done attribute:\n```xml\n\u003cw15:commentEx w15:paraId=\"123\" w15:done=\"1\"/\u003e\n```\n\n1. Add is_resolved property to Comment class\n2. Add resolve() and unresolve() methods to Comment\n3. Create/update commentsExtended.xml when changing status\n\n## Key Files to Modify\n- src/docx_redline/document.py - Support saving resolution status\n- src/docx_redline/models/comment.py - Add resolution properties/methods\n\n## API Design\n```python\n# Read resolution status\nif comment.is_resolved:\n    print('Already addressed')\n\n# Change resolution status\ncomment.resolve()\ncomment.unresolve()\n\n# Filter by status\nopen_comments = [c for c in doc.comments if not c.is_resolved]\n```\n\n## Acceptance Criteria\n- [ ] is_resolved property correctly reads status from commentsExtended.xml\n- [ ] resolve() marks comment as done in commentsExtended.xml\n- [ ] unresolve() removes done status\n- [ ] Resolved comments show as resolved in Word\n- [ ] Works with comments that have no commentsExtended entry\n- [ ] Unit tests cover resolution state changes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T21:33:33.263181-06:00","updated_at":"2025-12-08T21:47:34.11271-06:00","closed_at":"2025-12-08T21:47:34.11271-06:00","close_reason":"Implemented comment resolve/unresolve API with:\n- is_resolved property on Comment class\n- resolve() and unresolve() methods\n- Automatic commentsExtended.xml creation and management\n- paraId generation for linking comments to extended info\n- 8 new tests covering all resolution functionality\n- All 367 tests pass","dependencies":[{"issue_id":"docx_redline-1nx","depends_on_id":"docx_redline-2c7","type":"parent-child","created_at":"2025-12-08T21:33:33.264814-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-1nx","depends_on_id":"docx_redline-ogl","type":"blocks","created_at":"2025-12-08T21:33:33.26601-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-1vu","title":"Fix lxml FutureWarning deprecations","description":"lxml FutureWarnings about element truth testing will break in future versions.","design":"## Problem\nTest output shows:\n```\nFutureWarning: Truth-testing of elements was a source of confusion...\n  document.py:4921: if not end_run:\n  document.py:4945: if not end_run:\n```\n\n## Implementation\n1. Search for all boolean element checks in codebase:\n   ```bash\n   rg 'if not \\w+:' src/docx_redline/ --type py\n   rg 'if \\w+:' src/docx_redline/ --type py | grep -v 'if \\w+ is'\n   ```\n2. Replace:\n   - `if not elem:` → `if elem is None:`\n   - `if elem:` → `if elem is not None:`\n3. Run tests with warnings as errors to verify\n\n## Key Files\n- src/docx_redline/document.py - Primary file with issues\n- Any other files found by search\n\n## Verification\n```bash\npytest tests/ -W error::FutureWarning\n```\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] No FutureWarning when running pytest\n- [ ] All `if not elem:` patterns fixed\n- [ ] All `if elem:` patterns fixed (for lxml elements)\n- [ ] pytest tests/ -W error::FutureWarning passes\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-09T11:07:11.161097-06:00","updated_at":"2025-12-09T11:07:11.161097-06:00","dependencies":[{"issue_id":"docx_redline-1vu","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:07:11.162221-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-2c7","title":"Epic: Full Comment Management API","description":"Add complete comment management capabilities including creating, replying, resolving, and deleting comments. Currently only reading and bulk deletion are supported.","design":"## Overview\nComplete comment management API for Word documents, enabling programmatic document review workflows.\n\n## Current State\n- ✅ Read comments: doc.comments, doc.get_comments()\n- ✅ Delete all: doc.delete_all_comments()\n\n## Planned Features\n1. **Create comments** (docx_redline-ogl) - doc.add_comment()\n2. **Reply to comments** (docx_redline-af9) - comment.add_reply() or reply_to param\n3. **Resolve/unresolve** (docx_redline-1nx) - comment.resolve(), comment.is_resolved\n4. **Delete individual** (docx_redline-nxq) - comment.delete()\n\n## OOXML Structure\n- word/comments.xml - Comment content (w:comment elements)\n- word/commentsExtended.xml - Threading \u0026 resolution (w15:commentEx)\n- word/commentsIds.xml - Unique IDs for modern Word\n- document.xml - Range markers (commentRangeStart/End, commentReference)\n\n## Dependency Order\n1. Create comments (foundation)\n2. Replies, Resolve, Delete (can be parallel after #1)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-08T21:32:38.998566-06:00","updated_at":"2025-12-08T21:54:53.374137-06:00","closed_at":"2025-12-08T21:54:53.374137-06:00","close_reason":"All comment management features implemented:\n- ✅ Read comments (doc.comments, doc.get_comments())\n- ✅ Create comments (doc.add_comment())\n- ✅ Reply to comments (comment.add_reply(), reply_to param)\n- ✅ Resolve/unresolve (comment.resolve(), comment.unresolve(), comment.is_resolved)\n- ✅ Delete individual (comment.delete())\n- ✅ Delete all (doc.delete_all_comments())\n\nTotal: 71 comment-related tests, all 389 tests pass with 81% coverage."}
{"id":"docx_redline-37e","title":"Write README and basic documentation","description":"Create README.md with installation, quick start, basic examples. Link to docs/ folder for full API spec. Include the before/after code comparison to show value proposition.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T08:40:51.492926-06:00","updated_at":"2025-12-08T07:55:28.58129-06:00","closed_at":"2025-12-08T07:55:28.58129-06:00","close_reason":"completed","labels":["docs"]}
{"id":"docx_redline-3d8","title":"Improve validation module coverage","description":"Increase test coverage for validation modules from current 8-26% to 80%+.","design":"## Problem\nCurrent coverage:\n- validation.py: 26%\n- validation_redlining.py: 8%\n- validation_base.py: 67%\n\n## Implementation\n1. Add tests for validation.py:\n   - Test validate_document()\n   - Test validation result handling\n   \n2. Add tests for validation_redlining.py:\n   - Test redlining-specific validation rules\n   - Test error detection\n   \n3. Add tests for validation_base.py:\n   - Test base validation framework\n   - Test all uncovered branches\n\n## Key Files\n- tests/test_validation.py - Expand existing tests\n- tests/test_validation_redlining.py - NEW or expand\n\n## CRITICAL\nAll existing tests must continue to pass.","acceptance_criteria":"- [ ] validation.py coverage \u003e= 80%\n- [ ] validation_redlining.py coverage \u003e= 80%\n- [ ] validation_base.py coverage \u003e= 80%\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-09T11:11:57.298078-06:00","updated_at":"2025-12-09T11:11:57.298078-06:00","dependencies":[{"issue_id":"docx_redline-3d8","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:11:57.299285-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-3dx","title":"Implement batch operations (apply_edits)","description":"Add apply_edits(edits: list[dict]) method. Process list of edit specs in sequence. Return list of EditResult objects. See docs/PROPOSED_API.md lines 571-608.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T08:40:24.292971-06:00","updated_at":"2025-12-08T07:49:29.579584-06:00","closed_at":"2025-12-08T07:49:29.579584-06:00","close_reason":"completed","labels":["batch"]}
{"id":"docx_redline-3yq","title":"Extract StyleOperations class","description":"Extract apply_style, format_text, copy_format into a dedicated class.","design":"## Purpose\nMove style-related operations (~200 lines) out of Document.\n\n## Implementation\nCreate src/docx_redline/operations/styles.py:\n```python\n\"\"\"Style operations.\"\"\"\n\nclass StyleOperations:\n    \"\"\"Handles paragraph and text styling.\"\"\"\n    \n    def __init__(self, document: 'Document'):\n        self._doc = document\n    \n    def apply_style(self, find: str, style: str, **kwargs) -\u003e int:\n        \"\"\"Apply paragraph style to matching paragraphs.\"\"\"\n    \n    def format_text(self, find: str, bold: bool | None = None,\n                   italic: bool | None = None, **kwargs) -\u003e int:\n        \"\"\"Apply text formatting.\"\"\"\n    \n    def copy_format(self, from_text: str, to_text: str, **kwargs) -\u003e int:\n        \"\"\"Copy formatting from one text to another.\"\"\"\n```\n\n## Key Files\n- src/docx_redline/operations/styles.py - NEW (~200 lines)\n- src/docx_redline/document.py - Delegate style operations\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] StyleOperations class created\n- [ ] Document.apply_style() delegates\n- [ ] Document.format_text() delegates\n- [ ] Document.copy_format() delegates\n- [ ] ~200 lines removed from document.py\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-09T11:11:05.919803-06:00","updated_at":"2025-12-09T11:11:05.919803-06:00","dependencies":[{"issue_id":"docx_redline-3yq","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:11:05.921052-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-3yq","depends_on_id":"docx_redline-k52","type":"blocks","created_at":"2025-12-09T11:11:05.921855-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-47a","title":"Integration test: Complete surgical edits workflow","description":"End-to-end test using examples/surgical_edits.yaml. Must successfully apply all 11 edits. This is the success criteria for Phase 1 MVP. Create fixture document that matches the YAML edits.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-06T08:40:46.076275-06:00","updated_at":"2025-12-07T11:59:16.940807-06:00","closed_at":"2025-12-07T11:59:16.940807-06:00","close_reason":"blocked - requires replace_tracked, YAML support, and utilities","labels":["testing"]}
{"id":"docx_redline-4ty","title":"Refactor TrackedXMLGenerator to use lxml element construction","description":"Replace string-based XML generation with proper lxml element construction for safety and maintainability.","design":"## Purpose\nString interpolation for XML is error-prone. Using lxml's element construction ensures proper escaping and namespace handling.\n\n## Implementation\nRefactor tracked_xml.py methods to build elements directly:\n```python\ndef create_insertion(self, text: str, author: str | None = None) -\u003e Element:\n    \"\"\"Create a w:ins element.\"\"\"\n    author = author or self.default_author\n    timestamp = self._get_timestamp()\n    change_id = self._get_next_id()\n    \n    ins = etree.Element(f\"{{{W_NS}}}ins\", nsmap=NSMAP)\n    ins.set(f\"{{{W_NS}}}id\", str(change_id))\n    ins.set(f\"{{{W_NS}}}author\", author)  # lxml handles escaping\n    ins.set(f\"{{{W_NS}}}date\", timestamp)\n    \n    run = etree.SubElement(ins, f\"{{{W_NS}}}r\")\n    t = etree.SubElement(run, f\"{{{W_NS}}}t\")\n    t.text = text  # lxml handles escaping\n    \n    return ins\n```\n\n## Key Files\n- src/docx_redline/tracked_xml.py - Refactor all create_* methods\n- src/docx_redline/document.py - Update calls to use elements directly\n\n## Benefits\n- Automatic XML escaping by lxml\n- Proper namespace handling\n- No string parsing overhead\n- Easier to debug and extend\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] create_insertion() returns Element, not string\n- [ ] create_deletion() returns Element, not string\n- [ ] create_move_from() returns Element, not string\n- [ ] create_move_to() returns Element, not string\n- [ ] All callers updated to receive Elements\n- [ ] No string interpolation for XML in tracked_xml.py\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-09T11:11:24.188006-06:00","updated_at":"2025-12-09T11:11:24.188006-06:00","dependencies":[{"issue_id":"docx_redline-4ty","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:11:24.189312-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-4ty","depends_on_id":"docx_redline-tva","type":"blocks","created_at":"2025-12-09T11:11:24.190178-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-4ty","depends_on_id":"docx_redline-k52","type":"blocks","created_at":"2025-12-09T11:11:24.190774-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-50d","title":"Extract TrackedChangeOperations class","description":"Extract insert_tracked, delete_tracked, replace_tracked, move_tracked and helpers into a dedicated operations class.","design":"## Purpose\nThis is the largest extraction from Document - the core tracked change operations.\n\n## Implementation\nCreate src/docx_redline/operations/__init__.py and tracked_changes.py:\n```python\n\"\"\"Tracked change operations.\"\"\"\nfrom typing import Any\nfrom ..text_search import TextSearch\nfrom ..tracked_xml import TrackedXMLGenerator\n\nclass TrackedChangeOperations:\n    \"\"\"Handles insert, delete, replace, move with tracking.\"\"\"\n    \n    def __init__(self, document: 'Document'):\n        self._doc = document\n        self._xml_gen = TrackedXMLGenerator(document)\n        self._search = TextSearch()\n    \n    def insert(self, text: str, after: str | None = None,\n               before: str | None = None, **kwargs) -\u003e None:\n        \"\"\"Insert text with tracked changes.\"\"\"\n    \n    def delete(self, text: str, **kwargs) -\u003e None:\n        \"\"\"Delete text with tracked changes.\"\"\"\n    \n    def replace(self, find: str, replace: str, **kwargs) -\u003e None:\n        \"\"\"Replace text with tracked changes.\"\"\"\n    \n    def move(self, text: str, after: str | None = None,\n             before: str | None = None, **kwargs) -\u003e None:\n        \"\"\"Move text with tracked changes.\"\"\"\n    \n    # Private helper methods moved from Document:\n    def _insert_after_match(self, match, element) -\u003e None: ...\n    def _insert_before_match(self, match, element) -\u003e None: ...\n    def _replace_match_with_element(self, match, element) -\u003e None: ...\n    def _replace_match_with_elements(self, match, elements) -\u003e None: ...\n    def _split_and_replace_in_run(self, ...) -\u003e None: ...\n    def _split_and_replace_in_run_multiple(self, ...) -\u003e None: ...\n```\n\nDocument delegates to this class while maintaining the same public API.\n\n## Key Files\n- src/docx_redline/operations/__init__.py - NEW\n- src/docx_redline/operations/tracked_changes.py - NEW (~500 lines)\n- src/docx_redline/document.py - Delegate to TrackedChangeOperations\n\n## CRITICAL\nPublic API must remain unchanged. All 478 existing tests must pass.","acceptance_criteria":"- [ ] operations/ package created\n- [ ] TrackedChangeOperations class with insert/delete/replace/move\n- [ ] All helper methods moved (_insert_after_match, etc.)\n- [ ] Document.insert_tracked() delegates to operations class\n- [ ] Document.delete_tracked() delegates to operations class\n- [ ] Document.replace_tracked() delegates to operations class\n- [ ] Document.move_tracked() delegates to operations class\n- [ ] ~500 lines removed from document.py\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-09T11:09:41.152734-06:00","updated_at":"2025-12-09T11:09:41.152734-06:00","dependencies":[{"issue_id":"docx_redline-50d","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:09:41.153941-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-50d","depends_on_id":"docx_redline-k52","type":"blocks","created_at":"2025-12-09T11:09:41.154613-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-5at","title":"Epic: Production-Grade Refactoring","description":"Refactor docx_redline from prototype to production-grade library. See docs/CODE_REVIEW_REPORT.md for issues identified and docs/REFACTOR_PLAN.md for the full plan.","design":"## Overview\nSix-phase refactoring to address 22 identified issues:\n- Phase 1: Critical bug fixes\n- Phase 2: Foundation (constants, types, logging)\n- Phase 3: Extract package management classes\n- Phase 4: Extract domain operation classes\n- Phase 5: Refactor XML generation\n- Phase 6: Production hardening\n\n## Baseline\nTag: v0.1.0-pre-refactor (478 tests, 81% coverage)\nRevert command: git checkout v0.1.0-pre-refactor\n\n## Success Criteria\n- No file over 500 lines (except Document facade)\n- Document class under 200 lines (delegates to operation classes)\n- No Any types in public APIs\n- 90%+ test coverage\n- Zero FutureWarnings from lxml\n- All 478+ existing tests passing","acceptance_criteria":"- [ ] Phase 1 complete (critical bugs fixed)\n- [ ] Phase 2 complete (foundation established)\n- [ ] Phase 3 complete (package management extracted)\n- [ ] Phase 4 complete (domain operations extracted)\n- [ ] Phase 5 complete (XML generation refactored)\n- [ ] Phase 6 complete (production hardening)\n- [ ] All tests passing throughout\n- [ ] Coverage maintained or improved","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-09T11:05:48.084968-06:00","updated_at":"2025-12-09T11:05:48.084968-06:00"}
{"id":"docx_redline-79r","title":"Extract ChangeManagement class","description":"Extract accept/reject tracked changes methods into a dedicated class.","design":"## Purpose\nMove all accept/reject functionality out of Document.\n\n## Implementation\nCreate src/docx_redline/operations/change_management.py:\n```python\n\"\"\"Change acceptance and rejection operations.\"\"\"\n\nclass ChangeManagement:\n    \"\"\"Handles accepting/rejecting tracked changes.\"\"\"\n    \n    def __init__(self, document: 'Document'):\n        self._doc = document\n    \n    def accept_all(self) -\u003e None: ...\n    def reject_all(self) -\u003e None: ...\n    def accept_insertions(self) -\u003e int: ...\n    def reject_insertions(self) -\u003e int: ...\n    def accept_deletions(self) -\u003e int: ...\n    def reject_deletions(self) -\u003e int: ...\n    def accept_change(self, change_id: str | int) -\u003e None: ...\n    def reject_change(self, change_id: str | int) -\u003e None: ...\n    def accept_by_author(self, author: str) -\u003e int: ...\n    def reject_by_author(self, author: str) -\u003e int: ...\n    \n    # Private helpers\n    def _unwrap_element(self, element) -\u003e None: ...\n    def _unwrap_deletion(self, del_elem) -\u003e None: ...\n    def _remove_element(self, element) -\u003e None: ...\n```\n\n## Key Files\n- src/docx_redline/operations/change_management.py - NEW (~250 lines)\n- src/docx_redline/document.py - Delegate to ChangeManagement\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] ChangeManagement class created with all accept/reject methods\n- [ ] Helper methods moved (_unwrap_element, etc.)\n- [ ] Document delegates all accept/reject calls\n- [ ] ~250 lines removed from document.py\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-09T11:09:58.03918-06:00","updated_at":"2025-12-09T11:09:58.03918-06:00","dependencies":[{"issue_id":"docx_redline-79r","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:09:58.040386-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-79r","depends_on_id":"docx_redline-k52","type":"blocks","created_at":"2025-12-09T11:09:58.041079-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-7kd","title":"Add logging infrastructure","description":"Replace print() statements with proper logging. Add logging throughout for debuggability.","design":"## Problem\n- print() statements in library code (document.py:746-757)\n- No way to debug issues in production\n\n## Implementation\n1. Add logger setup in __init__.py:\n   ```python\n   import logging\n   logger = logging.getLogger(\"docx_redline\")\n   logger.addHandler(logging.NullHandler())\n   ```\n\n2. Replace all print() with appropriate log levels:\n   - print(\"CONTEXT PREVIEW\"...) → logger.debug()\n   - Error conditions → logger.warning() or logger.error()\n\n3. Add debug logging for key operations:\n   - Document load/save\n   - Text search matches found\n   - XML modifications made\n\n## Key Files\n- src/docx_redline/__init__.py - Add logger setup\n- src/docx_redline/document.py - Replace prints, add debug logging\n- src/docx_redline/text_search.py - Add debug logging\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] Logger configured in __init__.py\n- [ ] All print() statements replaced with logging\n- [ ] Debug logging added for document load/save\n- [ ] Debug logging added for text search\n- [ ] Library is silent by default (NullHandler)\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-09T11:07:57.233869-06:00","updated_at":"2025-12-09T11:07:57.233869-06:00","dependencies":[{"issue_id":"docx_redline-7kd","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:07:57.235067-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-7nh","title":"Implement delete_section() method","description":"Add delete_section() method to Document class for deleting entire sections with tracked changes.\n\nMethod signature:\ndef delete_section(\n    self,\n    heading: str,\n    track: bool = True,\n    update_toc: bool = False,\n    author: str | None = None\n) -\u003e Section:\n\nRequirements:\n- Find section by heading text\n- Delete heading paragraph + all paragraphs until next heading\n- If track=True, wrap all paragraphs in w:del elements\n- If track=False, delete elements completely\n- If update_toc=True, update any TOC fields (Phase 2 stretch goal)\n- Return the deleted Section object (for undo support)\n- Raise error if heading not found or ambiguous\n\nImplementation notes:\n- Use Section class to identify which paragraphs belong to section\n- Use existing scope system internally (scope='section:X')\n- For tracked deletion, wrap each paragraph in TrackedXMLGenerator.generate_deletion()\n- For untracked deletion, remove elements from tree\n- TOC update may need separate task if complex\n\nFiles to modify:\n- src/docx_redline/document.py\n- tests/test_structural_operations.py\n\nDependencies:\n- Section class (docx_redline-1g2)\n- Paragraph class (docx_redline-yik)\n\nSuccess criteria:\n- Can delete section by heading name\n- Tracked deletions work correctly\n- Untracked deletions work correctly\n- Proper error handling for missing/ambiguous headings\n- 8+ tests covering all scenarios\n- TOC update works (or marked as TODO for future)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T08:19:33.024815-06:00","updated_at":"2025-12-08T08:47:49.705915-06:00","closed_at":"2025-12-08T08:47:49.705915-06:00","close_reason":"Closed","labels":["core"]}
{"id":"docx_redline-8x1","title":"Epic 2: Phase 2 - Structural Operations","description":"Implement paragraph and section-level operations to enable complete document restructuring with tracked changes.\n\nGoal: Enable structural edits like adding new paragraphs, deleting entire sections, and updating TOCs.\n\nSuccess Criteria:\n- Can add new paragraphs with tracked changes\n- Can delete entire sections with tracked changes\n- Can update TOC automatically\n- All surgical_edits.yaml operations work\n\nDeliverables:\n- Paragraph and Section wrapper classes\n- insert_paragraph() and insert_paragraphs() methods\n- delete_section() with TOC updates\n- Comprehensive tests (\u003e85% coverage maintained)\n- Updated documentation","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-08T08:18:05.291164-06:00","updated_at":"2025-12-08T09:13:45.976649-06:00","closed_at":"2025-12-08T09:13:45.976649-06:00","close_reason":"Phase 2 structural operations complete! Implemented insert_paragraph(), insert_paragraphs(), and delete_section() with full tracked changes support. Added Section/Paragraph wrappers, integrated with batch/YAML workflows, created 6 comprehensive integration tests (154 total tests, 91% coverage), and documented all features in README. Ready for production use."}
{"id":"docx_redline-9qy","title":"Create type definitions module","description":"Replace excessive Any types with proper type aliases and protocols for better type safety.","design":"## Problem\nAny used throughout for lxml elements, losing all type safety:\n- TextSpan.runs: list[Any]\n- TextSpan.paragraph: Any\n- Many method parameters use Any\n\n## Implementation\nCreate src/docx_redline/types.py:\n```python\n\"\"\"Type definitions for docx_redline.\"\"\"\nfrom typing import TypeAlias, Protocol, Callable\nfrom lxml import etree\n\n# lxml type aliases\nElement: TypeAlias = etree._Element\nElementTree: TypeAlias = etree._ElementTree\n\n# Protocol for scope evaluators\nclass ScopeEvaluator(Protocol):\n    def __call__(self, paragraph: Element) -\u003e bool: ...\n\n# Protocol for text match objects\nclass TextMatch(Protocol):\n    @property\n    def runs(self) -\u003e list[Element]: ...\n    @property\n    def paragraph(self) -\u003e Element: ...\n    @property\n    def text(self) -\u003e str: ...\n```\n\nUpdate key files to use these types instead of Any.\n\n## Key Files\n- src/docx_redline/types.py - NEW\n- src/docx_redline/text_search.py - Update TextSpan\n- src/docx_redline/scope.py - Update evaluator types\n- src/docx_redline/document.py - Update method signatures\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] types.py created with Element, ElementTree aliases\n- [ ] TextSpan uses Element instead of Any\n- [ ] Key method signatures updated\n- [ ] mypy passes on updated files\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-09T11:08:16.199146-06:00","updated_at":"2025-12-09T11:08:16.199146-06:00","dependencies":[{"issue_id":"docx_redline-9qy","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:08:16.200301-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-a46","title":"Extract CommentOperations class","description":"Extract comment management (add, delete, resolve, list) into a dedicated class.","design":"## Purpose\nMove all comment functionality (~600 lines) out of Document.\n\n## Implementation\nCreate src/docx_redline/operations/comments.py:\n```python\n\"\"\"Comment operations.\"\"\"\nfrom ..models.comment import Comment\n\nclass CommentOperations:\n    \"\"\"Handles comment reading, adding, deleting.\"\"\"\n    \n    def __init__(self, document: 'Document'):\n        self._doc = document\n    \n    @property\n    def all(self) -\u003e list[Comment]:\n        \"\"\"Get all comments.\"\"\"\n    \n    def get(self, author: str | None = None, scope=None) -\u003e list[Comment]:\n        \"\"\"Get comments with optional filtering.\"\"\"\n    \n    def add(self, text: str, on: str | None = None,\n            reply_to=None, **kwargs) -\u003e Comment:\n        \"\"\"Add a comment.\"\"\"\n    \n    def delete(self, comment) -\u003e None:\n        \"\"\"Delete a comment.\"\"\"\n    \n    def delete_all(self) -\u003e None:\n        \"\"\"Delete all comments.\"\"\"\n    \n    def resolve(self, comment) -\u003e None:\n        \"\"\"Mark comment as resolved.\"\"\"\n    \n    def unresolve(self, comment) -\u003e None:\n        \"\"\"Mark comment as unresolved.\"\"\"\n    \n    # Move all private helpers:\n    # _load_comments_xml, _build_comment_ranges, _get_comment_ex,\n    # _get_next_comment_id, _insert_comment_markers, _add_comment_to_comments_xml,\n    # _resolve_comment_reference, _link_comment_reply, _set_comment_resolved,\n    # _delete_comment, _remove_comment_markers, _remove_from_comments_xml,\n    # _remove_from_comments_extended\n```\n\n## Key Files\n- src/docx_redline/operations/comments.py - NEW (~600 lines)\n- src/docx_redline/document.py - Delegate comment operations\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] CommentOperations class created\n- [ ] All comment helper methods moved\n- [ ] Document.comments delegates to operations class\n- [ ] Document.add_comment() delegates\n- [ ] Document.delete_all_comments() delegates\n- [ ] ~600 lines removed from document.py\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-09T11:10:17.900633-06:00","updated_at":"2025-12-09T11:10:17.900633-06:00","dependencies":[{"issue_id":"docx_redline-a46","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:10:17.902093-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-a46","depends_on_id":"docx_redline-spc","type":"blocks","created_at":"2025-12-09T11:10:17.902803-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-a46","depends_on_id":"docx_redline-kw7","type":"blocks","created_at":"2025-12-09T11:10:17.903282-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-af9","title":"Add comment reply API","description":"Implement comment replies (threaded comments) support.\n\n**What**: Add ability to reply to existing comments\n**Why**: Enable threaded discussions on document annotations\n**Where**: src/docx_redline/document.py, src/docx_redline/models/comment.py, word/commentsExtended.xml\n\n## Implementation Approach\nWord stores reply relationships in commentsExtended.xml using w15:commentEx elements with paraIdParent attributes. Need to:\n1. Add reply_to parameter to add_comment() or create add_reply() method on Comment\n2. Create/update word/commentsExtended.xml with parent-child relationships\n3. Track paragraph IDs (w14:paraId) for threading\n4. Add replies property to Comment class\n\n## Key Files to Modify\n- src/docx_redline/document.py - Support reply creation\n- src/docx_redline/models/comment.py - Add replies property, parent reference\n\n## API Design Options\n```python\n# Option A: Method on Comment\ncomment.add_reply('Response text', author='Responder')\n\n# Option B: Parameter on add_comment\ndoc.add_comment('Reply text', reply_to=comment_id, author='Responder')\n\n# Reading replies\nfor comment in doc.comments:\n    print(comment.text)\n    for reply in comment.replies:\n        print(f'  Reply: {reply.text}')\n```\n\n## Acceptance Criteria\n- [ ] Can create replies to existing comments\n- [ ] Replies are linked to parent comments in commentsExtended.xml\n- [ ] comment.replies returns child comments\n- [ ] comment.parent returns parent comment (or None for top-level)\n- [ ] Threaded comments display correctly in Word\n- [ ] Unit tests cover reply creation and reading","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T21:33:16.245769-06:00","updated_at":"2025-12-08T21:56:23.514071-06:00","closed_at":"2025-12-08T21:56:23.514071-06:00","close_reason":"completed","dependencies":[{"issue_id":"docx_redline-af9","depends_on_id":"docx_redline-2c7","type":"parent-child","created_at":"2025-12-08T21:33:16.246933-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-af9","depends_on_id":"docx_redline-ogl","type":"blocks","created_at":"2025-12-08T21:33:16.24766-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-b23","title":"Add replace_tracked() and delete_tracked()","description":"Extend Document class with replace_tracked(find, replace, scope) and delete_tracked(text, scope). Replace needs \u003cw:del\u003e + \u003cw:ins\u003e. Delete needs \u003cw:del\u003e with \u003cw:delText\u003e. See docs/PROPOSED_API.md lines 286-345.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T08:40:13.507108-06:00","updated_at":"2025-12-07T12:09:47.73834-06:00","closed_at":"2025-12-07T12:09:47.73834-06:00","close_reason":"completed","labels":["core"]}
{"id":"docx_redline-bm1","title":"Extract ContentTypeManager class","description":"Extract [Content_Types].xml management from Document into a dedicated class.","design":"## Purpose\nDocument has multiple _ensure_*_content_type() methods with duplicate logic.\n\n## Implementation\nCreate src/docx_redline/content_types.py:\n```python\n\"\"\"OOXML content type management.\"\"\"\nfrom lxml import etree\nfrom .constants import CT_NS\n\nclass ContentTypeManager:\n    \"\"\"Manages [Content_Types].xml.\"\"\"\n    \n    def __init__(self, package: 'OOXMLPackage'):\n        \"\"\"Initialize from package.\"\"\"\n        \n    def get_content_type(self, part_name: str) -\u003e str | None:\n        \"\"\"Get content type for a part.\"\"\"\n        \n    def has_override(self, part_name: str) -\u003e bool:\n        \"\"\"Check if override exists for part.\"\"\"\n        \n    def add_override(self, part_name: str, content_type: str) -\u003e None:\n        \"\"\"Add content type override.\"\"\"\n        \n    def remove_override(self, part_name: str) -\u003e bool:\n        \"\"\"Remove content type override.\"\"\"\n        \n    def save(self) -\u003e None:\n        \"\"\"Write changes back.\"\"\"\n```\n\n## Key Files\n- src/docx_redline/content_types.py - NEW (~100 lines)\n- src/docx_redline/document.py - Use ContentTypeManager, remove ~150 lines\n- tests/test_content_types.py - NEW unit tests\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] ContentTypeManager class created\n- [ ] Document uses ContentTypeManager for [Content_Types].xml\n- [ ] All _ensure_*_content_type() methods removed from Document\n- [ ] Unit tests for ContentTypeManager\n- [ ] ~150 lines removed from document.py\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-09T11:09:14.992157-06:00","updated_at":"2025-12-09T11:09:14.992157-06:00","dependencies":[{"issue_id":"docx_redline-bm1","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:09:14.993485-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-bm1","depends_on_id":"docx_redline-spc","type":"blocks","created_at":"2025-12-09T11:09:14.994132-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-bs9","title":"Create test suite for core operations","description":"Create tests/ directory with pytest tests. Test text_search with fragmented text, insert_tracked with various inputs, scope evaluation, error cases. Need test fixtures. Target \u003e80% coverage.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T08:40:40.565478-06:00","updated_at":"2025-12-08T08:01:13.326988-06:00","closed_at":"2025-12-08T08:01:13.326988-06:00","close_reason":"Closed","labels":["testing"]}
{"id":"docx_redline-bsp","title":"Epic: Phase 6 - Advanced Features \u0026 Refinements","description":"Phase 6 introduces advanced features including granular change management, table support, smart pattern-based replacements, and critical test suite fixes. This phase builds on the solid foundation of Phases 1-5 to enable more sophisticated document automation workflows.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-08T13:34:50.987718-06:00","updated_at":"2025-12-08T13:35:03.659014-06:00","labels":["epic phase-6"]}
{"id":"docx_redline-bsp.1","title":"Fix test suite validation errors","description":"22 tests are failing due to OOXML validation errors after adding comprehensive validation. Need to update test document helpers to create fully valid OOXML structure or add validate=False for unit tests. Priority: CRITICAL - blocks development.","status":"closed","priority":0,"issue_type":"task","assignee":"Claude","created_at":"2025-12-08T13:35:24.700188-06:00","updated_at":"2025-12-08T14:42:41.378378-06:00","closed_at":"2025-12-08T14:42:41.378378-06:00","close_reason":"completed","labels":["critical","phase-6","testing"],"dependencies":[{"issue_id":"docx_redline-bsp.1","depends_on_id":"docx_redline-bsp","type":"parent-child","created_at":"2025-12-08T13:35:24.701076-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-bsp.2","title":"Implement accept/reject individual changes","description":"Add granular change management: accept_change(id), reject_change(id), accept_by_author(), reject_by_author(), accept_insertions(), reject_deletions(). Currently only have accept_all_changes(). This enables selective review workflows and programmatic change management.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T13:35:38.301182-06:00","updated_at":"2025-12-08T17:05:41.656398-06:00","closed_at":"2025-12-08T17:05:41.656398-06:00","close_reason":"Completed: Implemented all 8 accept/reject methods with comprehensive tests. All 291 tests passing.","labels":["core","enhancement","phase-6"],"dependencies":[{"issue_id":"docx_redline-bsp.2","depends_on_id":"docx_redline-bsp","type":"parent-child","created_at":"2025-12-08T13:35:38.301939-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-bsp.3","title":"Add table support for tracked changes","description":"Enable editing tables with tracked changes: replace_tracked_in_table(), insert_table_row(), delete_table_row(), update_cell(). Tables are ubiquitous in contracts, reports, and financial docs. Currently requires manual XML manipulation. Major capability expansion.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T13:35:52.553641-06:00","updated_at":"2025-12-08T21:52:05.773252-06:00","closed_at":"2025-12-08T21:52:05.773252-06:00","close_reason":"Completed table support with tracked changes. Implemented Table/TableRow/TableCell wrapper classes, added tables property and find_table() to Document, implemented 4 table editing methods (update_cell, replace_in_table, insert_table_row, delete_table_row). All 34 table tests passing, 325 total tests passing.","labels":["core","enhancement","phase-6"],"dependencies":[{"issue_id":"docx_redline-bsp.3","depends_on_id":"docx_redline-bsp","type":"parent-child","created_at":"2025-12-08T13:35:52.554756-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-bsp.4","title":"Add smart find-replace patterns","description":"Pattern-based helpers for common replacements: replace_dates(), normalize_currency(), update_citations(). Reduces boilerplate for common patterns, prevents manual regex errors. Leverages existing text search infrastructure and context-awareness from Phase 5.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T13:39:48.403568-06:00","updated_at":"2025-12-08T22:08:03.264304-06:00","closed_at":"2025-12-08T22:08:03.264304-06:00","close_reason":"completed - with known limitations","labels":["enhancement","phase-6"],"dependencies":[{"issue_id":"docx_redline-bsp.4","depends_on_id":"docx_redline-bsp","type":"parent-child","created_at":"2025-12-08T13:39:48.405171-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-bsp.5","title":"Add style management","description":"Enable changing paragraph styles and text formatting: apply_style(), format_text(bold/italic/color), copy_format(). Common ask for document automation. Completes the 'surgical edit' vision.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T13:43:42.51117-06:00","updated_at":"2025-12-08T22:17:12.890213-06:00","closed_at":"2025-12-08T22:17:12.890213-06:00","close_reason":"completed","labels":["enhancement","phase-6"],"dependencies":[{"issue_id":"docx_redline-bsp.5","depends_on_id":"docx_redline-bsp","type":"parent-child","created_at":"2025-12-08T13:43:42.512307-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-bsp.6","title":"Add document comparison/diff","description":"Generate tracked changes by comparing two document versions: original.compare_to(modified). Enables version control workflows. Word has this built-in (Compare Documents), we should too. Powerful automation tool.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T13:47:59.071872-06:00","updated_at":"2025-12-09T09:54:50.406077-06:00","closed_at":"2025-12-09T09:54:50.406077-06:00","close_reason":"Completed: Implemented compare_to() for document comparison with tracked changes. Added has_tracked_changes() helper. 25 tests, all passing.","labels":["enhancement","phase-6"],"dependencies":[{"issue_id":"docx_redline-bsp.6","depends_on_id":"docx_redline-bsp","type":"parent-child","created_at":"2025-12-08T13:47:59.072797-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-bsp.7","title":"Add footnote/endnote support","description":"Support for adding/editing/deleting footnotes with tracked changes: insert_footnote(), delete_footnote(), update_footnote(). Essential for legal/academic documents. Currently completely unsupported. Natural extension of existing patterns.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T13:48:19.722978-06:00","updated_at":"2025-12-09T10:37:57.198765-06:00","closed_at":"2025-12-09T10:37:57.198765-06:00","close_reason":"completed","labels":["enhancement","phase-6"],"dependencies":[{"issue_id":"docx_redline-bsp.7","depends_on_id":"docx_redline-bsp","type":"parent-child","created_at":"2025-12-08T13:48:19.72378-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-c3m","title":"Create minimal Document class with insert_tracked()","description":"Create document.py with Document class. Load .docx, unpack if needed. Implement insert_tracked(text, after) - no scope yet. Use TextSearch to find text, TrackedXMLGenerator to create XML. Get ONE edit working end-to-end.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T08:39:57.294369-06:00","updated_at":"2025-12-07T11:54:47.188992-06:00","closed_at":"2025-12-07T11:54:47.188992-06:00","close_reason":"completed","labels":["core"]}
{"id":"docx_redline-eg1","title":"Add integration tests with real Word documents","description":"Add integration tests that use real Word documents to verify compatibility.","design":"## Purpose\nAll current tests use minimal synthetic XML. Need tests with real documents to catch edge cases.\n\n## Implementation\n1. Create tests/integration/ directory\n2. Add test documents created by Microsoft Word:\n   - Simple document\n   - Document with existing tracked changes\n   - Document with comments\n   - Document with tables\n   - Document with footnotes\n3. Create integration tests:\n   ```python\n   def test_open_word_document():\n       \"\"\"Test opening a real Word document.\"\"\"\n   \n   def test_edit_and_reopen():\n       \"\"\"Test round-trip: open -\u003e edit -\u003e save -\u003e reopen.\"\"\"\n   \n   def test_preserve_existing_changes():\n       \"\"\"Test that existing tracked changes are preserved.\"\"\"\n   \n   def test_document_opens_in_word():\n       \"\"\"Test that saved document is valid OOXML.\"\"\"\n   ```\n\n## Key Files\n- tests/integration/__init__.py - NEW\n- tests/integration/test_real_documents.py - NEW\n- tests/fixtures/ - Real .docx files\n\n## CRITICAL\nAll existing tests must continue to pass.","acceptance_criteria":"- [ ] tests/integration/ directory created\n- [ ] At least 3 real Word documents as test fixtures\n- [ ] Test opening real Word documents\n- [ ] Test round-trip editing\n- [ ] Test preserving existing tracked changes\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-09T11:11:41.587375-06:00","updated_at":"2025-12-09T11:11:41.587375-06:00","dependencies":[{"issue_id":"docx_redline-eg1","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:11:41.588859-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-eht","title":"Implement insert_paragraph() method","description":"Add insert_paragraph() method to Document class for inserting complete paragraphs with tracked changes.\n\nMethod signature:\ndef insert_paragraph(\n    self,\n    text: str,\n    after: str | None = None,\n    before: str | None = None,\n    style: str | None = None,\n    track: bool = True,\n    author: str | None = None,\n    scope: str | dict | Any | None = None\n) -\u003e Paragraph:\n\nRequirements:\n- Insert a complete new paragraph (w:p element)\n- Support both 'after' and 'before' positioning\n- Optional paragraph style (e.g., 'Normal', 'Heading1')\n- If track=True, wrap entire paragraph in w:ins element\n- If track=False, insert as accepted content\n- Return the created Paragraph object\n- Respect scope filters\n\nImplementation notes:\n- Need to find the anchor paragraph using existing search\n- Create new w:p element with w:r and w:t children\n- If tracked, wrap in TrackedXMLGenerator.generate_insertion()\n- Insert at correct position in document tree\n- Handle edge cases: insert after last paragraph, insert at beginning\n\nFiles to modify:\n- src/docx_redline/document.py\n- tests/test_structural_operations.py (create)\n\nDependencies:\n- Paragraph class (docx_redline-yik)\n\nSuccess criteria:\n- Can insert paragraph after/before specific text\n- Tracked insertions work correctly\n- Non-tracked insertions work correctly\n- Can specify paragraph style\n- 8+ tests covering all scenarios","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T08:18:58.452432-06:00","updated_at":"2025-12-08T08:36:48.47003-06:00","closed_at":"2025-12-08T08:36:48.47003-06:00","close_reason":"Closed","labels":["core"]}
{"id":"docx_redline-gnm","title":"Update documentation for Phase 2 features","description":"Update all documentation to reflect Phase 2 structural operations.\n\nFiles to update:\n\n1. **README.md**\n   - Add Phase 2 features to feature list\n   - Add examples for insert_paragraph(), insert_paragraphs(), delete_section()\n   - Update 'What's Working' section\n   - Update API reference section\n   - Update project status to 'Phase 2 Complete'\n\n2. **docs/TESTING.md**\n   - Document new test files (test_paragraph.py, test_section.py, test_structural_operations.py)\n   - Update coverage statistics\n   - Add Phase 2 operation examples\n\n3. **docs/PROPOSED_API.md**\n   - Mark Phase 2 as complete\n   - Update success criteria checklist\n\n4. **docs/IMPLEMENTATION_NOTES.md**\n   - Add implementation notes for Paragraph/Section classes\n   - Document design decisions\n   - Add troubleshooting notes\n\n5. **Create new guide** (optional)\n   - docs/STRUCTURAL_OPERATIONS.md - Deep dive on Phase 2 features\n\nRequirements:\n- All code examples must be tested and working\n- Update before/after comparisons if applicable\n- Ensure API documentation is accurate\n- Add real-world use case examples\n\nSuccess criteria:\n- README reflects all Phase 2 features\n- All docs are up to date\n- No TODO/placeholder sections remain\n- Examples can be copy-pasted and work","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T08:20:49.201521-06:00","updated_at":"2025-12-08T09:13:32.184965-06:00","closed_at":"2025-12-08T09:13:32.184965-06:00","close_reason":"Phase 2 documentation complete: Added structural operations examples to Quick Start, updated YAML examples to show Phase 1+2 operations, added Phase 2 methods to Core API, and updated Project Status section. All committed in f3b5aa7.","labels":["docs"]}
{"id":"docx_redline-k52","title":"Create centralized constants module","description":"WORD_NAMESPACE and other constants are duplicated across 6+ files. Create a single constants.py module.","design":"## Problem\nWORD_NAMESPACE defined in: document.py, text_search.py, scope.py, models/paragraph.py, models/comment.py, and more.\n\n## Implementation\nCreate src/docx_redline/constants.py:\n```python\n\"\"\"OOXML namespace and constant definitions.\"\"\"\n\n# OOXML Namespaces\nW_NS = \"http://schemas.openxmlformats.org/wordprocessingml/2006/main\"\nW14_NS = \"http://schemas.microsoft.com/office/word/2010/wordml\"\nW15_NS = \"http://schemas.microsoft.com/office/word/2012/wordml\"\nW16DU_NS = \"http://schemas.microsoft.com/office/word/2023/wordml/word16du\"\nREL_NS = \"http://schemas.openxmlformats.org/package/2006/relationships\"\nCT_NS = \"http://schemas.openxmlformats.org/package/2006/content-types\"\nXML_NS = \"http://www.w3.org/XML/1998/namespace\"\n\n# Namespace maps for lxml\nNSMAP = {\"w\": W_NS}\nNSMAP_FULL = {\"w\": W_NS, \"w14\": W14_NS, \"w15\": W15_NS, \"w16du\": W16DU_NS}\n\n# Relationship types\nREL_TYPE_COMMENTS = \"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments\"\nREL_TYPE_COMMENTS_EX = \"http://schemas.microsoft.com/office/2011/relationships/commentsExtended\"\nREL_TYPE_FOOTNOTES = \"http://schemas.openxmlformats.org/officeDocument/2006/relationships/footnotes\"\nREL_TYPE_ENDNOTES = \"http://schemas.openxmlformats.org/officeDocument/2006/relationships/endnotes\"\n\n# Content types\nCT_COMMENTS = \"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml\"\nCT_COMMENTS_EX = \"application/vnd.openxmlformats-officedocument.wordprocessingml.commentsExtended+xml\"\n\n# Configuration defaults\nCONTEXT_CHARS_DEFAULT = 40\nMAX_BATCH_ITERATIONS = 100\n```\n\nThen update all imports.\n\n## Key Files\n- src/docx_redline/constants.py - NEW\n- src/docx_redline/document.py - Update imports\n- src/docx_redline/text_search.py - Update imports\n- src/docx_redline/scope.py - Update imports\n- src/docx_redline/models/*.py - Update imports\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] constants.py created with all namespace definitions\n- [ ] All files updated to import from constants\n- [ ] No duplicate namespace definitions remain\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-09T11:07:40.940177-06:00","updated_at":"2025-12-09T11:07:40.940177-06:00","dependencies":[{"issue_id":"docx_redline-k52","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:07:40.941261-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-k9g","title":"Extract NoteOperations class for footnotes/endnotes","description":"Extract footnote and endnote operations into a dedicated class.","design":"## Purpose\nMove all footnote/endnote functionality (~400 lines) out of Document.\n\n## Implementation\nCreate src/docx_redline/operations/notes.py:\n```python\n\"\"\"Footnote and endnote operations.\"\"\"\nfrom ..models.footnote import Footnote, Endnote\n\nclass NoteOperations:\n    \"\"\"Handles footnotes and endnotes.\"\"\"\n    \n    def __init__(self, document: 'Document'):\n        self._doc = document\n    \n    @property\n    def footnotes(self) -\u003e list[Footnote]:\n        \"\"\"Get all footnotes.\"\"\"\n    \n    @property\n    def endnotes(self) -\u003e list[Endnote]:\n        \"\"\"Get all endnotes.\"\"\"\n    \n    def add_footnote(self, text: str, after: str, **kwargs) -\u003e Footnote:\n        \"\"\"Add a footnote.\"\"\"\n    \n    def add_endnote(self, text: str, after: str, **kwargs) -\u003e Endnote:\n        \"\"\"Add an endnote.\"\"\"\n    \n    # Move all private helpers for footnote/endnote handling\n```\n\n## Key Files\n- src/docx_redline/operations/notes.py - NEW (~400 lines)\n- src/docx_redline/document.py - Delegate note operations\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] NoteOperations class created\n- [ ] Document.footnotes delegates\n- [ ] Document.endnotes delegates\n- [ ] Document.add_footnote() delegates\n- [ ] Document.add_endnote() delegates\n- [ ] ~400 lines removed from document.py\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-09T11:10:34.632221-06:00","updated_at":"2025-12-09T11:10:34.632221-06:00","dependencies":[{"issue_id":"docx_redline-k9g","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:10:34.633842-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-k9g","depends_on_id":"docx_redline-spc","type":"blocks","created_at":"2025-12-09T11:10:34.63462-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-k9g","depends_on_id":"docx_redline-kw7","type":"blocks","created_at":"2025-12-09T11:10:34.63518-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-klh","title":"Implement basic scope system","description":"Create scope.py with ScopeEvaluator. Support string shortcuts: 'text' (paragraph containing), 'section:Name', 'heading:Name'. See docs/IMPLEMENTATION_NOTES.md lines 322-378. Parse scope spec, return callable that filters paragraphs.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T08:40:08.093686-06:00","updated_at":"2025-12-08T07:44:33.409945-06:00","closed_at":"2025-12-08T07:44:33.409945-06:00","close_reason":"completed","labels":["core"]}
{"id":"docx_redline-kw7","title":"Extract RelationshipManager class","description":"Extract relationship (.rels) file management from Document into a dedicated class.","design":"## Purpose\nDocument has ~8 nearly identical _ensure_*_relationship() methods. Extract to a reusable RelationshipManager.\n\n## Implementation\nCreate src/docx_redline/relationships.py:\n```python\n\"\"\"OOXML relationship management.\"\"\"\nfrom pathlib import Path\nfrom lxml import etree\nfrom .constants import REL_NS\n\nclass RelationshipManager:\n    \"\"\"Manages .rels files in OOXML packages.\"\"\"\n    \n    def __init__(self, package: 'OOXMLPackage', part_path: str):\n        \"\"\"Initialize for a specific part's relationships.\n        \n        Args:\n            package: The OOXML package\n            part_path: Path to the part (e.g., 'word/document.xml')\n        \"\"\"\n        \n    def get_target(self, rel_type: str) -\u003e str | None:\n        \"\"\"Get target for a relationship type.\"\"\"\n        \n    def has_relationship(self, rel_type: str) -\u003e bool:\n        \"\"\"Check if relationship exists.\"\"\"\n        \n    def add_relationship(self, rel_type: str, target: str) -\u003e str:\n        \"\"\"Add relationship, return assigned rId.\"\"\"\n        \n    def remove_relationship(self, rel_type: str) -\u003e bool:\n        \"\"\"Remove relationship by type.\"\"\"\n        \n    def save(self) -\u003e None:\n        \"\"\"Write changes back to .rels file.\"\"\"\n```\n\nThen replace all _ensure_*_relationship() methods in Document.\n\n## Key Files\n- src/docx_redline/relationships.py - NEW (~150 lines)\n- src/docx_redline/document.py - Use RelationshipManager, remove ~200 lines\n- tests/test_relationships.py - NEW unit tests\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] RelationshipManager class created\n- [ ] Document uses RelationshipManager for all .rels operations\n- [ ] All _ensure_*_relationship() methods removed from Document\n- [ ] Unit tests for RelationshipManager\n- [ ] ~200 lines removed from document.py\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-09T11:08:58.188636-06:00","updated_at":"2025-12-09T11:08:58.188636-06:00","dependencies":[{"issue_id":"docx_redline-kw7","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:08:58.190049-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-kw7","depends_on_id":"docx_redline-spc","type":"blocks","created_at":"2025-12-09T11:08:58.19077-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-lrn","title":"Implement insert_paragraphs() method","description":"Add insert_paragraphs() method to Document class for inserting multiple paragraphs at once.\n\nMethod signature:\ndef insert_paragraphs(\n    self,\n    texts: list[str],\n    after: str | None = None,\n    before: str | None = None,\n    style: str | None = None,\n    track: bool = True,\n    author: str | None = None,\n    scope: str | dict | Any | None = None\n) -\u003e list[Paragraph]:\n\nRequirements:\n- Insert multiple paragraphs in sequence\n- All paragraphs get the same style (if specified)\n- All inserted with same tracking state\n- Maintain order: first text in list appears first in document\n- Return list of created Paragraph objects\n- More efficient than calling insert_paragraph() in a loop\n\nImplementation notes:\n- Should use insert_paragraph() internally for consistency\n- Need to handle positioning: each subsequent paragraph inserts after the previous one\n- Consider wrapping all in a single w:ins if tracked (implementation detail)\n\nFiles to modify:\n- src/docx_redline/document.py\n- tests/test_structural_operations.py\n\nDependencies:\n- insert_paragraph() (docx_redline-eht)\n\nSuccess criteria:\n- Can insert multiple paragraphs at once\n- Paragraphs appear in correct order\n- Tracked insertions work correctly\n- 5+ tests covering edge cases","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T08:19:14.448143-06:00","updated_at":"2025-12-08T08:41:45.401156-06:00","closed_at":"2025-12-08T08:41:45.401156-06:00","close_reason":"Closed","labels":["core"]}
{"id":"docx_redline-lvb","title":"Implement YAML file support (apply_edit_file)","description":"Add apply_edit_file(path) method. Parse YAML with preprocessing, edits, validation, output_options. Support all edit types from examples/surgical_edits.yaml. Use pyyaml library.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T08:40:29.70876-06:00","updated_at":"2025-12-08T07:52:17.433214-06:00","closed_at":"2025-12-08T07:52:17.433214-06:00","close_reason":"completed","labels":["batch"]}
{"id":"docx_redline-m8v","title":"Create integration tests for Phase 2 operations","description":"Add comprehensive integration tests demonstrating complete Phase 2 workflows.\n\nRequirements:\n- Test realistic document restructuring scenarios\n- Test combining Phase 1 and Phase 2 operations\n- Test surgical_edits.yaml example (or subset that's feasible)\n- Test error handling and edge cases\n- Ensure 85%+ coverage is maintained\n\nTest scenarios to cover:\n1. Add multiple paragraphs to a section with tracked changes\n2. Delete an entire section and verify TOC updates\n3. Mix text edits (Phase 1) with structural edits (Phase 2)\n4. Apply Phase 2 operations from YAML file\n5. Error recovery when section not found\n6. Complex document with multiple sections and TOC\n\nFiles to modify:\n- tests/test_integration.py (add new tests)\n- tests/test_structural_operations.py (if not already comprehensive)\n\nDependencies:\n- All Phase 2 operations implemented\n\nSuccess criteria:\n- 5+ new integration tests\n- Tests cover realistic use cases\n- All tests pass\n- Coverage remains \u003e85%\n- Demonstrates value of Phase 2 features","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T08:20:29.068636-06:00","updated_at":"2025-12-08T09:09:40.802343-06:00","closed_at":"2025-12-08T09:09:40.802343-06:00","close_reason":"Closed","labels":["testing"]}
{"id":"docx_redline-nxq","title":"Add individual comment deletion API","description":"Implement deletion of individual comments (vs existing delete_all_comments).\n\n**What**: Add ability to delete specific comments by ID or reference\n**Why**: Enable selective comment removal during document cleanup\n**Where**: src/docx_redline/document.py, src/docx_redline/models/comment.py\n\n## Implementation Approach\n1. Add delete() method to Comment class\n2. Remove w:comment element from comments.xml\n3. Remove commentRangeStart, commentRangeEnd, commentReference from document body\n4. Clean up commentsExtended.xml entry if present\n5. Handle cascading deletion of replies\n\n## Key Files to Modify\n- src/docx_redline/document.py - Add delete_comment() helper\n- src/docx_redline/models/comment.py - Add delete() method\n\n## API Design\n```python\n# Delete by reference\ncomment = doc.comments[0]\ncomment.delete()\n\n# Delete by ID\ndoc.delete_comment(comment_id='0')\n\n# Delete with replies\ncomment.delete(include_replies=True)  # default True\n```\n\n## Acceptance Criteria\n- [ ] comment.delete() removes the comment from document\n- [ ] Range markers (start/end/reference) removed from document body\n- [ ] Comment removed from comments.xml\n- [ ] Extended info removed from commentsExtended.xml\n- [ ] Replies are deleted when parent is deleted (by default)\n- [ ] Document remains valid OOXML after deletion\n- [ ] Empty comments.xml is cleaned up (file removed)\n- [ ] Unit tests cover single and cascading deletion","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T21:33:50.212098-06:00","updated_at":"2025-12-08T21:50:22.750371-06:00","closed_at":"2025-12-08T21:50:22.750371-06:00","close_reason":"Implemented individual comment deletion with Comment.delete() method. This removes comment markers from document body, the comment from comments.xml, and any entry from commentsExtended.xml. Added 7 tests, all 374 tests pass.","dependencies":[{"issue_id":"docx_redline-nxq","depends_on_id":"docx_redline-2c7","type":"parent-child","created_at":"2025-12-08T21:33:50.213666-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-nxq","depends_on_id":"docx_redline-ogl","type":"blocks","created_at":"2025-12-08T21:33:50.214662-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-o7p","title":"Add regex support with capture groups","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T09:29:12.233941-06:00","updated_at":"2025-12-08T09:29:26.313488-06:00","closed_at":"2025-12-08T09:29:26.313488-06:00","close_reason":"Phase 2.5 regex support complete\\! Implemented regex parameter for insert_tracked(), delete_tracked(), and replace_tracked() with full capture group support. Added 14 comprehensive tests covering basic patterns, capture groups, error handling, and batch operations. All 168 tests passing with 92% coverage. Documented with examples in README. Users can now use powerful regex patterns like doc.replace_tracked(r'(\\d+) days', r'\\1 business days', regex=True) for advanced find/replace operations.","labels":["enhancement","phase-2.5"]}
{"id":"docx_redline-ogl","title":"Add comment creation API","description":"Implement doc.add_comment() to create new comments on document text.\n\n**What**: Add method to create comments that mark specific text ranges\n**Why**: Enable programmatic document review and annotation\n**Where**: src/docx_redline/document.py, src/docx_redline/models/comment.py\n\n## Implementation Approach\n1. Add add_comment() method to Document class\n2. Handle creating/updating word/comments.xml if it doesn't exist\n3. Insert commentRangeStart, commentRangeEnd, commentReference markers in document body\n4. Manage comment ID allocation (find max existing ID + 1)\n5. Create relationships and content types if needed\n\n## Key Files to Modify\n- src/docx_redline/document.py - Add add_comment() method\n- src/docx_redline/models/comment.py - Add helper methods if needed\n\n## API Design\n```python\ndoc.add_comment(\n    text='Please review this section',\n    on='marked text to annotate',  # or regex pattern\n    author='Reviewer Name',\n    scope=None,  # optional scope filter\n)\n```\n\n## Acceptance Criteria\n- [ ] add_comment() creates valid OOXML comment structure\n- [ ] Comment appears in doc.comments after creation\n- [ ] Marked text is correctly identified with range markers\n- [ ] Works on documents with no existing comments\n- [ ] Works on documents with existing comments\n- [ ] Document opens correctly in Word/LibreOffice after save\n- [ ] Unit tests cover success and error cases","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T21:32:58.15226-06:00","updated_at":"2025-12-08T21:39:14.580985-06:00","closed_at":"2025-12-08T21:39:14.580985-06:00","close_reason":"Implemented add_comment() method with:\n- Full OOXML comment structure support (comments.xml, relationships, content types)\n- Automatic comment ID allocation\n- Auto-generated initials from author name\n- Insertion of commentRangeStart/End and commentReference markers\n- Works with documents with/without existing comments\n- 14 new tests covering all functionality\n- All 359 tests pass","dependencies":[{"issue_id":"docx_redline-ogl","depends_on_id":"docx_redline-2c7","type":"parent-child","created_at":"2025-12-08T21:32:58.153624-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-spc","title":"Extract OOXMLPackage class for ZIP handling","description":"Extract OOXML ZIP package management from Document into a dedicated OOXMLPackage class.","design":"## Purpose\nFirst step in breaking up the God class. Package management is self-contained and can be extracted cleanly.\n\n## Implementation\nCreate src/docx_redline/package.py:\n```python\n\"\"\"OOXML package management.\"\"\"\nfrom pathlib import Path\nimport tempfile\nimport shutil\nimport zipfile\nfrom lxml import etree\n\nclass OOXMLPackage:\n    \"\"\"Manages the OOXML ZIP package structure.\"\"\"\n    \n    def __init__(self, path: Path | str):\n        self.path = Path(path)\n        self._temp_dir: Path | None = None\n    \n    def extract(self) -\u003e Path:\n        \"\"\"Extract to temp directory, return path.\"\"\"\n        \n    def get_part(self, part_name: str) -\u003e etree._Element | None:\n        \"\"\"Load and parse an XML part.\"\"\"\n        \n    def set_part(self, part_name: str, element: etree._Element) -\u003e None:\n        \"\"\"Write an XML part.\"\"\"\n        \n    def has_part(self, part_name: str) -\u003e bool:\n        \"\"\"Check if a part exists.\"\"\"\n        \n    def delete_part(self, part_name: str) -\u003e bool:\n        \"\"\"Delete a part from the package.\"\"\"\n        \n    def save(self, output_path: Path | str) -\u003e None:\n        \"\"\"Repack the ZIP file.\"\"\"\n        \n    def close(self) -\u003e None:\n        \"\"\"Clean up temp directory.\"\"\"\n        \n    def __enter__(self) -\u003e 'OOXMLPackage':\n        return self\n        \n    def __exit__(self, *args) -\u003e None:\n        self.close()\n```\n\nThen update Document to use OOXMLPackage internally.\n\n## Key Files\n- src/docx_redline/package.py - NEW (~200 lines)\n- src/docx_redline/document.py - Use OOXMLPackage, remove extraction/save code\n- tests/test_package.py - NEW unit tests\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] OOXMLPackage class created with full API\n- [ ] Document uses OOXMLPackage for ZIP operations\n- [ ] Temp directory cleanup handled by OOXMLPackage\n- [ ] Unit tests for OOXMLPackage (extract, get_part, save, close)\n- [ ] ~100 lines removed from document.py\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-09T11:08:37.912086-06:00","updated_at":"2025-12-09T11:08:37.912086-06:00","dependencies":[{"issue_id":"docx_redline-spc","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:08:37.91335-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-spc","depends_on_id":"docx_redline-k52","type":"blocks","created_at":"2025-12-09T11:08:37.914036-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-tva","title":"Fix author name XML escaping vulnerability","description":"Author names are interpolated into XML without escaping, which can produce malformed XML if author contains quotes or special characters.","design":"## Problem\nIn tracked_xml.py, create_insertion() and other methods do:\n```python\nxml = f'\u003cw:ins w:author=\"{author}\" ...'\n```\nIf author is 'John \"Jack\" Doe', the XML breaks.\n\n## Implementation\n1. Apply _escape_xml() to author parameter in:\n   - create_insertion()\n   - create_deletion() \n   - create_move_from()\n   - create_move_to()\n2. Also escape in identity_attrs string building\n\n## Key Files\n- src/docx_redline/tracked_xml.py - Add escaping to all author usages\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] Author names with double quotes work correctly\n- [ ] Author names with \u003c, \u003e, \u0026, ' work correctly\n- [ ] Test case added for each special character\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-09T11:06:30.557332-06:00","updated_at":"2025-12-09T11:06:30.557332-06:00","dependencies":[{"issue_id":"docx_redline-tva","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:06:30.56527-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-uj2","title":"Implement custom exception classes","description":"Create errors.py with DocxRedlineError, TextNotFoundError, AmbiguousTextError, ValidationError. Include helpful __str__ methods with suggestions. See docs/IMPLEMENTATION_NOTES.md lines 448-490.","status":"closed","priority":2,"issue_type":"task","assignee":"Claude","created_at":"2025-12-06T08:39:41.151381-06:00","updated_at":"2025-12-06T09:20:09.438051-06:00","closed_at":"2025-12-06T09:20:09.438051-06:00","close_reason":"Closed","labels":["foundation"]}
{"id":"docx_redline-ut5","title":"Add Phase 2 operations to batch/YAML support","description":"Extend apply_edits() and YAML support to handle new Phase 2 structural operations.\n\nRequirements:\n- Add support for 'insert_paragraph' edit type\n- Add support for 'insert_paragraphs' edit type\n- Add support for 'delete_section' edit type\n- Update EditResult to handle these operations\n- Ensure all parameters are supported in YAML/dict format\n\nYAML format examples:\nedits:\n  - type: insert_paragraph\n    text: 'New paragraph content'\n    after: 'anchor text'\n    style: 'Normal'\n    track: true\n    \n  - type: insert_paragraphs\n    texts: ['Para 1', 'Para 2', 'Para 3']\n    before: 'anchor text'\n    track: true\n    \n  - type: delete_section\n    heading: 'Section Title'\n    track: true\n    update_toc: true\n\nFiles to modify:\n- src/docx_redline/document.py (apply_edits method)\n- tests/test_batch_operations.py\n- tests/test_yaml_support.py\n\nDependencies:\n- All Phase 2 operation methods (docx_redline-eht, docx_redline-lrn, docx_redline-7nh)\n\nSuccess criteria:\n- Can specify all Phase 2 operations in YAML\n- apply_edits() correctly dispatches to new operations\n- EditResult messages are informative\n- 10+ tests for new operation types in batch mode","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T08:20:12.287477-06:00","updated_at":"2025-12-08T08:50:31.580473-06:00","closed_at":"2025-12-08T08:50:31.580473-06:00","close_reason":"Closed","labels":["batch"]}
{"id":"docx_redline-uuw","title":"Implement proper change ID tracking","description":"Fix _get_max_change_id() which always returns 0, causing ID collisions with existing tracked changes.","design":"## Problem\ntracked_xml.py:288-301 has a TODO stub that always returns 0. This means if a document already has tracked changes with IDs 1-10, new changes will start at 1 again, causing ID collisions.\n\n## Implementation\n1. In TrackedXMLGenerator._get_max_change_id(), scan doc.xml_root for:\n   - w:ins elements with w:id attribute\n   - w:del elements with w:id attribute  \n   - w:moveFrom elements with w:id attribute\n   - w:moveTo elements with w:id attribute\n   - w:moveFromRangeStart/w:moveToRangeStart with w:id\n2. Return max ID found, or 0 if none\n\n## Key Files\n- src/docx_redline/tracked_xml.py - Implement _get_max_change_id()\n- tests/test_document.py - Add tests with pre-existing tracked changes\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] _get_max_change_id() scans for all tracked change types\n- [ ] New changes get IDs higher than existing changes\n- [ ] Test with document containing existing tracked changes\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-09T11:06:12.714388-06:00","updated_at":"2025-12-09T11:06:12.714388-06:00","dependencies":[{"issue_id":"docx_redline-uuw","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:06:12.718142-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-v2j","title":"Extract PatternHelpers class","description":"Extract normalize_currency, normalize_dates, update_section_references into a dedicated class.","design":"## Purpose\nMove common document editing patterns (~300 lines) out of Document.\n\n## Implementation\nCreate src/docx_redline/operations/patterns.py:\n```python\n\"\"\"Common document editing patterns.\"\"\"\n\nclass PatternHelpers:\n    \"\"\"High-level document editing patterns.\"\"\"\n    \n    def __init__(self, document: 'Document'):\n        self._doc = document\n    \n    def normalize_currency(self, from_symbol: str, to_symbol: str,\n                          **kwargs) -\u003e int:\n        \"\"\"Normalize currency symbols.\"\"\"\n    \n    def normalize_dates(self, from_format: str, to_format: str,\n                       **kwargs) -\u003e int:\n        \"\"\"Normalize date formats.\"\"\"\n    \n    def update_section_references(self, old_number: str, new_number: str,\n                                  **kwargs) -\u003e int:\n        \"\"\"Update section/article references.\"\"\"\n```\n\n## Key Files\n- src/docx_redline/operations/patterns.py - NEW (~300 lines)\n- src/docx_redline/document.py - Delegate pattern operations\n\n## CRITICAL\nAll 478 existing tests must pass after this change.","acceptance_criteria":"- [ ] PatternHelpers class created\n- [ ] Document.normalize_currency() delegates\n- [ ] Document.normalize_dates() delegates\n- [ ] Document.update_section_references() delegates\n- [ ] ~300 lines removed from document.py\n- [ ] All existing tests pass (pytest tests/ -v)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-09T11:10:50.160541-06:00","updated_at":"2025-12-09T11:10:50.160541-06:00","dependencies":[{"issue_id":"docx_redline-v2j","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:10:50.161728-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-v2j","depends_on_id":"docx_redline-50d","type":"blocks","created_at":"2025-12-09T11:10:50.162427-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-vfs","title":"Final Document class cleanup and verification","description":"Final cleanup of Document class after all extractions. Verify it's under 500 lines and serves as a clean facade.","design":"## Purpose\nAfter all operation classes are extracted, Document should be a thin facade that:\n- Handles initialization (load from path)\n- Maintains state (xml_root, package, author)\n- Delegates all operations to extracted classes\n- Provides clean public API\n\n## Implementation\n1. Review remaining code in Document\n2. Remove any remaining duplicated code\n3. Ensure consistent delegation pattern\n4. Add class-level documentation explaining architecture\n5. Verify line count is under 500\n\n## Verification\n```bash\nwc -l src/docx_redline/document.py  # Should be \u003c 500\npytest tests/ -v  # All tests pass\npytest tests/ --cov=src/docx_redline --cov-fail-under=80  # Coverage maintained\n```\n\n## CRITICAL\nAll existing tests must pass. Public API must remain unchanged.","acceptance_criteria":"- [ ] Document class is under 500 lines\n- [ ] Document serves as pure facade (minimal logic)\n- [ ] All delegation is consistent\n- [ ] Class documentation updated\n- [ ] All 478+ tests pass\n- [ ] Coverage \u003e= 80%","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-09T11:12:17.222789-06:00","updated_at":"2025-12-09T11:12:17.222789-06:00","dependencies":[{"issue_id":"docx_redline-vfs","depends_on_id":"docx_redline-5at","type":"parent-child","created_at":"2025-12-09T11:12:17.224013-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-vfs","depends_on_id":"docx_redline-50d","type":"blocks","created_at":"2025-12-09T11:12:17.224647-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-vfs","depends_on_id":"docx_redline-79r","type":"blocks","created_at":"2025-12-09T11:12:17.225127-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-vfs","depends_on_id":"docx_redline-a46","type":"blocks","created_at":"2025-12-09T11:12:17.225576-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-vfs","depends_on_id":"docx_redline-k9g","type":"blocks","created_at":"2025-12-09T11:12:17.226033-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-vfs","depends_on_id":"docx_redline-v2j","type":"blocks","created_at":"2025-12-09T11:12:17.226479-06:00","created_by":"parkerhancock"},{"issue_id":"docx_redline-vfs","depends_on_id":"docx_redline-3yq","type":"blocks","created_at":"2025-12-09T11:12:17.226908-06:00","created_by":"parkerhancock"}]}
{"id":"docx_redline-vtz","title":"Add accept_all_changes() and delete_all_comments()","description":"Implement accept_all_changes() - remove all \u003cw:ins\u003e wrappers, delete all \u003cw:del\u003e content. Implement delete_all_comments() - remove all comment elements. These are preprocessing operations.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T08:40:35.140426-06:00","updated_at":"2025-12-07T12:32:27.2614-06:00","closed_at":"2025-12-07T12:32:27.2614-06:00","close_reason":"completed","labels":["utility"]}
{"id":"docx_redline-vvi","title":"Set up Python package structure","description":"Create pyproject.toml, src/docx_redline/__init__.py, basic directory structure. Dependencies: lxml, python-dateutil, pyyaml. Use modern Python packaging. Target Python 3.10+.","status":"closed","priority":2,"issue_type":"task","assignee":"Claude","created_at":"2025-12-06T08:39:35.767332-06:00","updated_at":"2025-12-06T09:06:24.31418-06:00","closed_at":"2025-12-06T09:06:24.31418-06:00","close_reason":"Closed","labels":["setup"]}
{"id":"docx_redline-wq7","title":"Add error handling with suggestions","description":"Implement SuggestionGenerator for helpful error messages. When text not found, try fuzzy match, search without scope, check for common issues (curly quotes, double spaces). See docs/IMPLEMENTATION_NOTES.md lines 494-522.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T08:40:18.891673-06:00","updated_at":"2025-12-08T07:36:52.609623-06:00","closed_at":"2025-12-08T07:36:52.609623-06:00","close_reason":"completed","labels":["polish"]}
{"id":"docx_redline-xpe","title":"Implement TOC update functionality","description":"Add Table of Contents update functionality to automatically refresh TOC after structural changes.\n\nRequirements:\n- Detect TOC fields in document (w:sdt with w:docPartGallery='Table of Contents')\n- Update TOC to reflect current document structure\n- Handle multiple TOCs in same document\n- Mark TOC as needing update (Word will regenerate on open)\n- Or fully regenerate TOC if possible\n\nImplementation approaches to consider:\n1. Simple: Set w:fldDirty='true' on TOC fields (Word updates on open)\n2. Medium: Update TOC XML structure directly\n3. Complex: Fully regenerate TOC from document headings\n\nFiles to create:\n- src/docx_redline/toc.py\n- tests/test_toc.py\n\nImplementation notes:\n- Approach 1 (dirty flag) is simplest and most reliable\n- Word handles the actual regeneration\n- Should work with delete_section(update_toc=True)\n\nSuccess criteria:\n- TOC fields are marked for update after section deletion\n- Word successfully regenerates TOC when opening document\n- 5+ tests for TOC detection and update marking\n- Works with delete_section() integration","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T08:19:53.038453-06:00","updated_at":"2025-12-08T08:58:51.627965-06:00","closed_at":"2025-12-08T08:58:51.627965-06:00","close_reason":"TOC update is too complex for the value it provides. Users can manually update TOCs in Word.","labels":["utility"]}
{"id":"docx_redline-ye8","title":"Implement text search with fragmentation handling","description":"Create text_search.py with TextSearch class. Core algorithm: build character map across runs, find text, map back to run indices. This is THE critical piece. See docs/IMPLEMENTATION_NOTES.md lines 227-274. Must handle text split across multiple \u003cw:r\u003e elements.","status":"closed","priority":0,"issue_type":"task","assignee":"Claude","created_at":"2025-12-06T08:39:46.536923-06:00","updated_at":"2025-12-06T09:21:48.981693-06:00","closed_at":"2025-12-06T09:21:48.981693-06:00","close_reason":"Closed","labels":["core"]}
{"id":"docx_redline-yik","title":"Create Paragraph wrapper class","description":"Create a Paragraph class to wrap w:p XML elements with convenient methods.\n\nRequirements:\n- Wrap lxml Element representing a w:p\n- Property: text (get/set paragraph text)\n- Property: style (get/set paragraph style)\n- Property: runs (access w:r elements)\n- Method: is_heading() - detect if paragraph is a heading\n- Method: get_heading_level() - return heading level (1-9) or None\n- Method: contains(text) - check if paragraph contains text\n- Property: parent (access parent Section if in one)\n\nImplementation notes:\n- Similar pattern to python-docx Paragraph class\n- Keep it simple - just wrap the XML, don't duplicate Document logic\n- Should work with existing scope system\n\nFiles to create:\n- src/docx_redline/models/paragraph.py\n- tests/test_paragraph.py\n\nSuccess criteria:\n- Can create Paragraph from w:p element\n- Can read/write text and style properties\n- Heading detection works correctly\n- 10+ tests covering all methods","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-08T08:18:23.118867-06:00","updated_at":"2025-12-08T08:29:47.038188-06:00","closed_at":"2025-12-08T08:29:47.038188-06:00","close_reason":"Closed","labels":["core"]}
{"id":"docx_redline-yk0","title":"Implement TextSpan class","description":"Create text_span.py with TextSpan dataclass. Represents found text across potentially multiple runs. Properties: text, context, location. Methods: insert_before(), insert_after(), replace(), delete(). See docs/PROPOSED_API.md lines 684-716.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T08:40:02.685708-06:00","updated_at":"2025-12-07T12:34:55.845742-06:00","closed_at":"2025-12-07T12:34:55.845742-06:00","close_reason":"completed","labels":["core"]}
